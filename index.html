<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MBTI Field Trainer</title>
  <link rel="manifest" href="manifest.json">
  <style>
    :root {
      --bg:#0b0f14; --card:#121a24; --border:#223043;
      --text:#e8f0fb; --muted:#8aa0b6; --accent:#5bbcff;
      --good:#29d17d; --bad:#ff5b5b;
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--text);}
    header{position:sticky;top:0;background:rgba(11,15,20,0.92);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);padding:14px 16px;}
    h1{margin:0;font-size:16px;display:flex;justify-content:space-between;align-items:center;gap:10px;}
    main{padding:16px;max-width:900px;margin:0 auto;}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px;margin-bottom:12px;}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px;}
    .muted{color:var(--muted);}
    .big{font-size:20px;font-weight:800;}
    button{
      width:100%;text-align:left;
      border:1px solid var(--border);background:#0f1620;color:var(--text);
      padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer;
    }
    button:hover{border-color:#2c3f57;}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--border);padding:4px 10px;border-radius:999px;}
    ul{margin:8px 0 0 18px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .row button{width:auto;}
    .divider{height:1px;background:var(--border);margin:12px 0;}
    .accent{color:var(--accent);}
    .topControls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px;}
    .topControls > *{flex:1;}
    select{
      width:100%;
      border:1px solid var(--border);
      background:#0f1620;color:var(--text);
      padding:12px 14px;border-radius:12px;font-weight:700;
    }
    .resultGood{color:var(--good);font-weight:800;}
    .resultBad{color:var(--bad);font-weight:800;}
    .small{font-size:12px;}
  </style>
</head>
<body>
<header>
  <h1>
    <span>MBTI Field Trainer</span>
    <span class="pill" id="status">Loadingâ€¦</span>
  </h1>
</header>

<main>
  <div class="topControls">
    <select id="modeSelect" aria-label="Training mode">
      <option value="browse">Mode: Browse</option>
      <option value="quizType">Mode: Quiz (Guess the Type)</option>
    </select>
    <button onclick="resetStats()">ðŸ§¹ Reset Stats</button>
  </div>

  <div class="grid" id="typeGrid"></div>

  <div class="card" id="detailCard" style="display:none;"></div>
</main>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  }

  const statusEl = document.getElementById("status");
  const gridEl = document.getElementById("typeGrid");
  const detailEl = document.getElementById("detailCard");
  const modeSelect = document.getElementById("modeSelect");

  let LIB = null;

  // --- MBTI expansions (for repetition training) ---
  const LETTER = {
    I: "Introverted",
    E: "Extraverted",
    N: "Intuitive",
    S: "Sensing",
    T: "Thinking",
    F: "Feeling",
    J: "Judging",
    P: "Perceiving"
  };

  function expandType(code){
    if(!code || code.length !== 4) return "";
    const parts = code.split("").map(ch => LETTER[ch] || ch);
    return `${code} (${parts.join(", ")})`;
  }

  function setStatus(txt){ statusEl.textContent = txt; }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&","&amp;")
      .re
